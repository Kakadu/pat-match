(env
  (dev
    (flags (-strict-sequence -short-paths -strict-formats -short-paths -keep-locs -w -3-9-32))))

(library
  (name        helper)
  (public_name helper)
  (modules     helper)

  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
  (flags      (-rectypes))
  (libraries  OCanren)
)

(library
  (name        mytester)
  ;(public_name helper)
  (modules     mytester)

  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
  (flags      (-rectypes))
  (libraries  mtime.clock.os OCanren)
)

(executable
  (name main)
  (modules main)
  (flags (-rectypes))
  (libraries ocanren)
  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
)


(rule
 (targets work.ml)
 (deps    work.ml2mk.ml)
 (action  (run noCanren work.ml2mk.ml -o %{targets})))

(rule
 (targets work_guards.ml)
 (deps    work_guards.ml2mk.ml)
 (action  (run noCanren work_guards.ml2mk.ml -o %{targets})))

(rule
 (targets work_nonlinear.ml)
 (deps    work_nonlinear.ml2mk.ml)
 (action  (run noCanren -unnesting-mode -without-activate-tactics %{deps} -o %{targets})))

(rule
 (targets work_unnested.ml)
 (deps    work_unnested.ml2mk.ml)
 (action  (run noCanren -unnesting-mode -without-activate-tactics %{deps} -o %{targets})))

(executable
  (name main2)
  (modules main2 work)
  (flags (-rectypes))
  (libraries OCanren OCanren.tester helper)
  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
)

(executable
  (name main_gadt)
  (modules main_gadt)
  (flags (-rectypes))
  (libraries OCanren OCanren.tester helper)
  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
)

(executable
  (name main_guards)
  (modules main_guards work_guards)
  (flags (-rectypes))
  (libraries OCanren OCanren.tester helper)
  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
)

(executable
  (name main_unnested)
  (modules main_unnested work_unnested)
  (flags (-rectypes))
  (libraries OCanren helper mytester)
  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
)

(executable
  (name main_nonlinear)
  (modules main_nonlinear work_nonlinear)
  (flags (-rectypes))
  (libraries OCanren OCanren.tester helper)
  (preprocess (pps OCanren-ppx.ppx_repr OCanren-ppx.ppx_fresh GT.ppx))
)
